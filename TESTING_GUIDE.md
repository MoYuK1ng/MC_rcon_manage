# 🧪 测试指南 / Testing Guide

## 📋 功能测试清单

### 1. 用户注册功能测试

#### 测试步骤：
1. 访问注册页面：`http://localhost:8000/register/`
2. 填写表单：
   - 用户名：`testuser`
   - 邮箱：`test@example.com`
   - 密码：`TestPass123!`
   - 确认密码：`TestPass123!`
   - 验证码：解答数学题
3. 点击"创建账号"按钮

#### 预期结果：
- ✅ 注册成功后自动登录
- ✅ 跳转到仪表板页面
- ✅ 显示成功消息："注册成功！欢迎使用 IronGate。"

#### 测试验证码功能：
- ✅ 输入错误答案应显示错误提示
- ✅ 验证码图片应该可以刷新
- ✅ 5分钟后验证码过期

---

### 2. 登录功能测试

#### 测试步骤：
1. 访问登录页面：`http://localhost:8000/accounts/login/`
2. 输入用户名和密码
3. 点击"登录"按钮

#### 预期结果：
- ✅ 登录成功后跳转到仪表板
- ✅ 导航栏显示用户名
- ✅ 显示"我的白名单"链接

#### 测试注册链接：
- ✅ 登录页面应显示"还没有账号？立即注册"链接
- ✅ 点击链接应跳转到注册页面

---

### 3. 白名单申请功能测试

#### 前提条件：
- 管理员已创建服务器
- 管理员已将服务器分配给用户组
- 用户已加入该组

#### 测试步骤：
1. 登录后访问仪表板
2. 找到可访问的服务器
3. 在"添加到白名单"表单中输入MC用户名
4. 点击"添加"按钮

#### 预期结果：
- ✅ 成功添加后显示成功消息
- ✅ 白名单申请状态显示为"待处理"或"已处理"

#### 测试重复申请保护：
1. 尝试添加相同的MC用户名
2. 预期结果：
   - ✅ 显示警告消息
   - ✅ 提示该用户名已存在
   - ✅ 显示当前状态

---

### 4. 我的白名单页面测试

#### 测试步骤：
1. 点击导航栏用户菜单
2. 选择"我的白名单"
3. 或直接访问：`http://localhost:8000/my-whitelist/`

#### 预期结果：
- ✅ 显示所有白名单申请历史
- ✅ 显示服务器名称
- ✅ 显示MC用户名
- ✅ 显示申请状态（待处理/已处理/失败）
- ✅ 显示提交时间
- ✅ 显示响应日志（如果有）

#### 测试统计信息：
- ✅ 总申请数正确
- ✅ 已处理数量正确
- ✅ 待处理数量正确

#### 测试空状态：
- 如果没有申请记录：
  - ✅ 显示空状态提示
  - ✅ 显示"前往仪表板"按钮

---

### 5. Admin后台测试

#### 测试步骤：
1. 使用管理员账号登录
2. 访问：`http://localhost:8000/admin/`

#### 预期结果：
- ✅ 显示美化的Jazzmin主题
- ✅ 现代化UI设计
- ✅ 响应式布局

#### 测试用户管理增强：
1. 进入"用户"管理页面
2. 预期结果：
   - ✅ 列表显示"白名单申请"列
   - ✅ 显示格式：`总数 (已批准数 ✓)`
   - ✅ 例如：`3 (2 ✓)` 表示3个申请，2个已批准

3. 点击编辑某个用户
4. 预期结果：
   - ✅ 页面底部显示该用户的所有白名单申请
   - ✅ 以表格形式内联显示
   - ✅ 显示服务器、MC用户名、状态、创建时间

---

### 6. 双语支持测试

#### 测试英文界面：
1. 点击导航栏的地球图标
2. 选择"English"
3. 预期结果：
   - ✅ 所有界面文字切换为英文
   - ✅ 登录页面为英文
   - ✅ 注册页面为英文
   - ✅ 仪表板为英文
   - ✅ 我的白名单页面为英文

#### 测试中文界面：
1. 点击导航栏的地球图标
2. 选择"简体中文"
3. 预期结果：
   - ✅ 所有界面文字切换为中文
   - ✅ 登录页面为中文
   - ✅ 注册页面为中文
   - ✅ 仪表板为中文
   - ✅ 我的白名单页面为中文

---

## 🔧 管理员配置测试

### 创建测试环境

#### 1. 创建管理员账号
```bash
python manage.py createsuperuser
```

#### 2. 创建用户组
1. 登录Admin后台
2. 进入"组"管理
3. 创建新组，例如："VIP玩家"

#### 3. 创建服务器
1. 进入"服务器"管理
2. 点击"添加服务器"
3. 填写信息：
   - 名称：`测试服务器`
   - IP地址：`127.0.0.1`
   - RCON端口：`25575`
   - RCON密码：`your_password`
   - 访问组：选择"VIP玩家"

#### 4. 创建普通用户并分配组
1. 进入"用户"管理
2. 创建新用户
3. 编辑用户，将其加入"VIP玩家"组

---

## 🐛 已知问题和解决方案

### 问题1：翻译文件未编译
**症状**：某些翻译可能不显示

**解决方案**：
```bash
# Windows需要安装gettext
choco install gettext

# 然后编译翻译
python manage.py compilemessages
```

**临时方案**：Django会自动使用.po文件，不影响使用

### 问题2：验证码不显示
**症状**：注册页面验证码图片不显示

**解决方案**：
```bash
# 确保已安装Pillow
pip install Pillow

# 运行迁移
python manage.py migrate
```

### 问题3：静态文件404
**症状**：CSS/JS文件加载失败

**解决方案**：
```bash
# 收集静态文件
python manage.py collectstatic --noinput

# 或在开发环境中确保DEBUG=True
```

---

## 📊 性能测试

### 测试场景1：大量白名单申请
1. 创建100+个白名单申请
2. 访问"我的白名单"页面
3. 预期：页面加载时间 < 2秒

### 测试场景2：并发注册
1. 多个用户同时注册
2. 预期：验证码系统正常工作，无冲突

### 测试场景3：重复申请检测
1. 快速连续提交相同的白名单申请
2. 预期：数据库约束生效，只保存一条记录

---

## ✅ 测试检查清单

### 功能测试
- [ ] 用户注册功能正常
- [ ] 验证码系统工作正常
- [ ] 登录功能正常
- [ ] 白名单申请功能正常
- [ ] 重复申请保护生效
- [ ] 我的白名单页面显示正常
- [ ] Admin用户管理增强功能正常
- [ ] 双语切换功能正常

### UI/UX测试
- [ ] 所有页面响应式设计正常
- [ ] 图标正确显示
- [ ] 动画效果流畅
- [ ] 表单验证提示清晰
- [ ] 错误消息友好

### 安全测试
- [ ] CSRF保护启用
- [ ] 密码加密存储
- [ ] SQL注入防护
- [ ] XSS防护
- [ ] 验证码防机器人

### 性能测试
- [ ] 页面加载速度 < 2秒
- [ ] 数据库查询优化
- [ ] 静态文件缓存

---

## 🎯 测试报告模板

### 测试日期：____________________
### 测试人员：____________________
### 测试环境：____________________

| 功能模块 | 测试结果 | 问题描述 | 严重程度 |
|---------|---------|---------|---------|
| 用户注册 | ✅/❌ | | 高/中/低 |
| 用户登录 | ✅/❌ | | 高/中/低 |
| 白名单申请 | ✅/❌ | | 高/中/低 |
| 我的白名单 | ✅/❌ | | 高/中/低 |
| Admin增强 | ✅/❌ | | 高/中/低 |
| 双语支持 | ✅/❌ | | 高/中/低 |

### 总体评价：
- 通过的测试：____/____
- 发现的问题：____个
- 建议：

---

## 📞 支持

如果在测试过程中遇到问题：
1. 查看服务器日志
2. 检查浏览器控制台
3. 查看Django错误页面
4. 提交Issue到GitHub

---

**测试完成后，请确保：**
1. ✅ 所有核心功能正常工作
2. ✅ 没有严重的安全漏洞
3. ✅ 用户体验流畅
4. ✅ 文档完整准确
