{% extends 'base_zh.html' %}

{% block title %}仪表板 - MC RCON Manager{% endblock %}

{% block extra_css %}
<style>
    .server-card {
        transition: all 0.3s ease;
    }
    .server-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .status-indicator {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: .5; }
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8 animate-fade-in">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    服务器仪表板
                </h1>
                <p class="text-gray-600">
                    管理您的 Minecraft 服务器
                </p>
            </div>
        </div>

        <!-- 公告区域 -->
        {% if announcements %}
        <div class="mb-8 space-y-4 animate-fade-in">
            {% for announcement in announcements %}
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-lg p-6 shadow-sm">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <i data-lucide="megaphone" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <div class="ml-4 flex-1">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">
                            {{ announcement.title }}
                        </h3>
                        <div class="text-gray-700 prose prose-sm max-w-none">
                            {{ announcement.content|safe }}
                        </div>
                        <div class="mt-3 flex items-center text-sm text-gray-500">
                            <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                            {{ announcement.created_at|date:"Y年m月d日 H:i" }}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Server Cards -->
        {% if servers %}
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {% for server in servers %}
                <div class="server-card bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden animate-slide-up">
                    <!-- Server Header -->
                    <div class="bg-gradient-to-r from-primary-500 to-primary-700 px-6 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                                    <i data-lucide="server" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">{{ server.name }}</h3>
                                    {% if display_settings.show_ip_to_users or display_settings.show_port_to_users %}
                                    <p class="text-primary-100 text-sm">
                                        {% if display_settings.show_ip_to_users %}{{ server.ip_address }}{% endif %}{% if display_settings.show_ip_to_users and display_settings.show_port_to_users %}:{% endif %}{% if display_settings.show_port_to_users %}{{ server.rcon_port }}{% endif %}
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="status-indicator w-3 h-3 bg-green-400 rounded-full"></div>
                                <span class="text-white text-sm font-medium">在线</span>
                            </div>
                        </div>
                    </div>

                    <!-- Server Stats -->
                    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="users" class="w-5 h-5 text-primary-600"></i>
                                </div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">
                                    玩家
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="activity" class="w-5 h-5 text-green-600"></i>
                                </div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">
                                    状态
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Player List -->
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="mb-3">
                            <h4 class="text-sm font-semibold text-gray-900 flex items-center">
                                <i data-lucide="users" class="w-4 h-4 mr-2 text-gray-400"></i>
                                在线玩家
                            </h4>
                        </div>
                        <div 
                            hx-get="{% url 'player_list' server.id %}" 
                            hx-trigger="load, every 30s"
                            hx-swap="innerHTML"
                            class="min-h-[100px]"
                        >
                            <div class="flex items-center justify-center py-8">
                                <div class="flex flex-col items-center space-y-2">
                                    <div class="w-8 h-8 border-4 border-gray-200 border-t-primary-600 rounded-full animate-spin"></div>
                                    <span class="text-sm text-gray-500">加载中...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Whitelist Form -->
                    <div class="px-6 py-4 bg-gray-50">
                        <h4 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                            <i data-lucide="user-plus" class="w-4 h-4 mr-2 text-gray-400"></i>
                            添加到白名单
                        </h4>
                        <form method="post" action="{% url 'whitelist_add' server.id %}" class="space-y-3">
                            {% csrf_token %}
                            <div>
                                <div class="flex space-x-2">
                                    <input 
                                        type="text" 
                                        name="minecraft_username" 
                                        class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200 text-sm"
                                        placeholder="Minecraft 用户名"
                                        pattern="[a-zA-Z0-9_]{3,16}"
                                        title="3-16个字符，仅限字母、数字和下划线"
                                        required
                                    >
                                    <button 
                                        type="submit" 
                                        class="px-6 py-2.5 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2"
                                    >
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 flex items-center">
                                    <i data-lucide="info" class="w-3.5 h-3.5 mr-1.5"></i>
                                    3-16个字符，仅限字母数字和下划线
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- No Servers Message -->
            <div class="text-center py-16 animate-fade-in">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mb-6">
                    <i data-lucide="server-off" class="w-10 h-10 text-gray-400"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">
                    没有可用的服务器
                </h3>
                <p class="text-gray-600 max-w-md mx-auto">
                    您还没有访问任何服务器的权限。请联系管理员将您添加到服务器组。
                </p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
